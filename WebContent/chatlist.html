<!DOCTYPE html>

<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<!-- Head BEGIN -->
<head>
    <meta charset="utf-8">
    <title>校园闲置物品租赁平台</title>

    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta content="Metronic Shop UI description" name="description">
    <meta content="Metronic Shop UI keywords" name="keywords">
    <meta content="keenthemes" name="author">

    <meta property="og:site_name" content="-CUSTOMER VALUE-">
    <meta property="og:title" content="-CUSTOMER VALUE-">
    <meta property="og:description" content="-CUSTOMER VALUE-">
    <meta property="og:type" content="website">
    <meta property="og:image" content="-CUSTOMER VALUE-"><!-- link to image for socio -->
    <meta property="og:url" content="-CUSTOMER VALUE-">

    <link rel="shortcut icon" href="favicon.ico">
    <link href="layui/css/layui.css" rel="stylesheet">
    <!-- Fonts START -->
    <!-- Fonts END -->

    <!-- Global styles START -->
    <link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Global styles END -->

    <!-- Page level plugin styles START -->
    <link href="assets/plugins/fancybox/source/jquery.fancybox.css" rel="stylesheet">
    <link href="assets/plugins/owl.carousel/assets/owl.carousel.css" rel="stylesheet">
    <link href="assets/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css">
    <!-- Page level plugin styles END -->

    <!-- Theme styles START -->
    <link href="assets/pages/css/components.css" rel="stylesheet">
    <link href="assets/corporate/css/style.css" rel="stylesheet">
    <link href="assets/pages/css/style-shop.css" rel="stylesheet" type="text/css">
    <link href="assets/corporate/css/style-responsive.css" rel="stylesheet">
    <link href="assets/corporate/css/themes/red.css" rel="stylesheet" id="style-color">
    <link href="assets/corporate/css/custom.css" rel="stylesheet">
    <!-- Theme styles END -->
</head>
<!-- Head END -->

<!-- Body BEGIN -->
<body class="ecommerce">
<!-- BEGIN STYLE CUSTOMIZER -->
<div class="color-panel hidden-sm">
    <div class="color-mode-icons icon-color"></div>
    <div class="color-mode-icons icon-color-close"></div>
    <div class="color-mode">
        <p>THEME COLOR</p>
        <ul class="inline">
            <li class="color-red current color-default" data-style="red"></li>
            <li class="color-blue" data-style="blue"></li>
            <li class="color-green" data-style="green"></li>
            <li class="color-orange" data-style="orange"></li>
            <li class="color-gray" data-style="gray"></li>
            <li class="color-turquoise" data-style="turquoise"></li>
        </ul>
    </div>
</div>
<!-- END BEGIN STYLE CUSTOMIZER -->

<!-- BEGIN TOP BAR -->
<div class="pre-header" id="loginiframe">
</div>
<!-- END TOP BAR -->

<!-- BEGIN HEADER -->
<div class="header">
    <div class="container" id="headeriframe">
        <!-- BEGIN chat -->
        <!--END chat -->
        <!-- BEGIN NAVIGATION -->
        <!-- END NAVIGATION -->
    </div>
</div>
<!-- Header END -->

<div class="main">
    <div class="container">
        <ul class="breadcrumb">
            <li><a href="index.html">首页</a></li>
            <li class="active">在线留言</li>
        </ul>
        <!-- BEGIN SIDEBAR & CONTENT -->
        <div class="row margin-bottom-40" id="app">
            <!-- BEGIN SIDEBAR -->
            <!-- END SIDEBAR -->

            <!-- BEGIN CONTENT -->
            <div class="col-md-9 col-sm-9">
                <h1>在线留言</h1>
                <div class="content-page">
                    <div id="map" class="gmaps margin-bottom-40" style="height:400px;">
                        <div class="tab-pane fade in active">
                            <!--<p>There are no reviews for this product.</p>-->
                            <div v-for="chat in chatlist" class="review-item clearfix"
                                 style="display: flex;width: 100%">
                                <div class="review-item-submitted" style="border: 0px solid red;width: 5%">
                                    <div>
                                        <img :src="['upload/'+chat.member.filename]" style="display: block;width: 100%">
                                        <strong style="margin-left: 5px;">{{chat.member.tname}}</strong>
                                    </div>
                                </div>
                                <div class="review-item-content" style="padding: 0px 0px 0px 20px;">
                                    <em>{{chat.savetime}}</em>
                                    <p v-html="chat.content"></p>
                                    <p v-if="chat.hfcontent!=null && chat.hfcontent!=''" style="padding-left: 30px;">
                                        <span class="layui-badge" style="margin-right: 10px;">管理员:</span>{{chat.hfcontent}}
                                    </p>
                                </div>
                            </div>

                            <div id="demo1" style="text-align:center"></div>
                            <!-- BEGIN FORM-->
                            <!-- END FORM-->
                        </div>
                    </div>

                    <!-- BEGIN FORM-->
                    <div style="margin-top: 300px">
                        <div class="form-group">
                            <label for="chat">请在下方填写留言内容</label>
                            <textarea class="form-control" rows="8" v-model="content" id="chat"></textarea>
                        </div>
                        <div class="padding-top-20">
                            <button type="submit" class="btn btn-primary" @click="add()">提交</button>
                        </div>

                    </div>
                </div>
                <!-- END FORM-->
            </div>
        </div>
        <!-- END CONTENT -->
    </div>
    <!-- END SIDEBAR & CONTENT -->
</div>
</div>

<!-- BEGIN BRANDS -->
<!-- END BRANDS -->

<!-- BEGIN STEPS -->
<!-- END STEPS -->

<!-- BEGIN PRE-FOOTER -->
<!-- END PRE-FOOTER -->

<!-- BEGIN FOOTER -->
<div class="footer" id="footiframe">
</div>
<!-- END FOOTER -->

<!-- Load javascripts at bottom, this will reduce page load time -->
<!-- BEGIN CORE PLUGINS(REQUIRED FOR ALL PAGES) -->
<!--[if lt IE 9]>
<script src="assets/plugins/respond.min.js"></script>
<![endif]-->
<script src="assets/plugins/jquery.min.js" type="text/javascript"></script>
<script src="assets/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script src="assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/corporate/scripts/back-to-top.js" type="text/javascript"></script>
<script src="assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->

<!-- BEGIN PAGE LEVEL JAVASCRIPTS (REQUIRED ONLY FOR CURRENT PAGE) -->
<script src="assets/plugins/fancybox/source/jquery.fancybox.pack.js" type="text/javascript"></script><!-- pop up -->
<script src="assets/plugins/owl.carousel/owl.carousel.min.js" type="text/javascript"></script>
<!-- slider for products -->
<script src='assets/plugins/zoom/jquery.zoom.min.js' type="text/javascript"></script><!-- product zoom -->
<script src="assets/plugins/bootstrap-touchspin/bootstrap.touchspin.js" type="text/javascript"></script>
<!-- Quantity -->
<script src="assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="assets/pages/scripts/contact-us.js" type="text/javascript"></script>

<script src="assets/corporate/scripts/layout.js" type="text/javascript"></script>
<!-- END PAGE LEVEL JAVASCRIPTS -->
</body>
<script type="text/javascript" src="axios/vue.js"></script>
<script type="text/javascript" src="axios/axios.min.js"></script>
<script type="text/javascript" src="axios/qs.js"></script>
<script type="text/javascript" src="axios/getUrlParams.js"></script>
<script type="text/javascript" src="layer/layer.js"></script>
<script src="layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    var qs = Qs
    var vmm = new Vue({
        el: '#app',
        data: {
            chatlist: [],
            content: "",
            pageSize: 5,
        },
        mounted() {
            sessionStorage.setItem("signoutShow", "chat")
            this.getchatlist()

            jQuery(document).ready(function () {
                Layout.init();
                Layout.initOWL();
                Layout.initImageZoom();
                Layout.initTouchspin();
                //Layout.initTwitter();
            });

        },
        methods: {

            getchatlist() {
                axios.post('chatLb.do', qs.stringify({
                    pageSize: this.pageSize
                })).then(response => {
                    layui.use(['laypage', 'layer'], function () {
                        var laypage = layui.laypage
                            , layer = layui.layer;
                        //总页数大于页码总数
                        laypage.render({
                            elem: 'demo1'
                            , limit: vmm.pageSize
                            , count: response.data.list.length //数据总数
                            , jump: function (obj, first) {
                                vmm.current_page(obj.curr, vmm.pageSize)
                                console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                            }
                        });
                    });
                }).catch(error => {
                    console.log(error)
                })
            },
            current_page(page, pageSize) {
                axios.post('chatLb.do', qs.stringify({
                    pageNum: page,
                    pageSize: pageSize,
                })).then(response => {
                    this.chatlist = response.data.pageInfo.list
                }).catch(error => {
                    console.log(error)
                })
            },


            add() {
                axios.post('checkmember.do', qs.stringify({})).then(response => {
                    if (response.data.data == 200) {
                        axios.post('chatAdd.do', qs.stringify({
                            content: this.content,
                        })).then(response => {
                            layer.msg("操作成功", {icon: 6})
                            this.getchatlist()
                        }).catch(error => {
                            console.log(error)
                        })
                    } else {
                        location.replace("login.html")
                    }
                }).catch(error => {
                    console.log(error)
                })

            },
        }
    });
</script>

<script type="text/javascript">
    window.onload = function () {
        $("#loginiframe").load("iframe/loginiframe.html")
        $("#headeriframe").load("iframe/headeriframe.html")
        $("#footiframe").load("iframe/footiframe.html")

    }
</script>
<!-- END BODY -->
</html>